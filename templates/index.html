<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUBBY - AI 자막 & 더빙</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
    font-family: 'Inter', -apple-system, sans-serif;
    background-color: #f8fafc;
    color: #1e293b;
}
.glass-card {
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(226,232,240,0.8);
}
.loading-bar {
    height: 20px;
    width: 0%;
    background-color: #3b82f6;
    border-radius: 10px;
    transition: width 0.2s ease;
}
</style>
</head>

<body class="min-h-screen py-6 px-4">

<!-- UI 언어 선택 -->
<div class="fixed top-6 right-6">
    <select id="uiLanguage" class="p-2 border rounded-lg text-sm">
        <option value="ko">한국어</option>
        <option value="en">English</option>
        <option value="ja">日本語</option>
        <option value="zh">中文</option>
    </select>
</div>

<div class="max-w-5xl mx-auto">

<header class="flex items-center mb-8">
    <h1 class="text-2xl font-bold">DUBBY</h1>
</header>

<main class="grid grid-cols-1 md:grid-cols-12 gap-6">

<div class="md:col-span-5 lg:col-span-4">
<div class="glass-card p-6 rounded-2xl shadow-sm space-y-4">

    <!-- 숨겨진 실제 파일 input -->
    <input type="file" id="videoFile" accept="video/*,audio/*" class="hidden">

    <!-- 커스텀 파일 버튼 -->
    <button id="fileButton"
            class="w-full p-3 border rounded-xl bg-white"
            data-i18n="chooseFile">
        파일 선택
    </button>

    <p id="fileName" class="text-sm text-slate-500"
       data-i18n="noFile">
       선택된 파일 없음
    </p>

    <!-- 번역 대상 언어 -->
    <select id="language" class="w-full p-3 border rounded-xl">
        <option value="ko"></option>
        <option value="en"></option>
        <option value="ja"></option>
        <option value="zh-cn"></option>
    </select>

    <button id="subtitleBtn"
            class="w-full bg-blue-600 text-white p-3 rounded-xl"
            data-i18n="subtitleBtn">
        자막 생성
    </button>

    <button id="dubbingBtn"
            class="w-full bg-slate-900 text-white p-3 rounded-xl"
            data-i18n="dubbingBtn">
        더빙 생성
    </button>

</div>
</div>

</main>
</div>

<script>

/* =========================
   번역 데이터
========================= */

const translations = {
    ko: {
        chooseFile: "파일 선택",
        noFile: "선택된 파일 없음",
        subtitleBtn: "자막 생성",
        dubbingBtn: "더빙 생성",
        languages: {
            ko: "한국어",
            en: "영어",
            ja: "일본어",
            "zh-cn": "중국어"
        }
    },
    en: {
        chooseFile: "Choose File",
        noFile: "No file selected",
        subtitleBtn: "Generate Subtitles",
        dubbingBtn: "Generate Dubbing",
        languages: {
            ko: "Korean",
            en: "English",
            ja: "Japanese",
            "zh-cn": "Chinese"
        }
    },
    ja: {
        chooseFile: "ファイルを選択",
        noFile: "ファイルが選択されていません",
        subtitleBtn: "字幕生成",
        dubbingBtn: "吹き替え生成",
        languages: {
            ko: "韓国語",
            en: "英語",
            ja: "日本語",
            "zh-cn": "中国語"
        }
    },
    zh: {
        chooseFile: "选择文件",
        noFile: "未选择文件",
        subtitleBtn: "生成字幕",
        dubbingBtn: "生成配音",
        languages: {
            ko: "韩语",
            en: "英语",
            ja: "日语",
            "zh-cn": "中文"
        }
    }
};

/* =========================
   DOM 로드 후 실행
========================= */

window.addEventListener("DOMContentLoaded", function(){

    const uiSelect = document.getElementById("uiLanguage");
    const languageSelect = document.getElementById("language");
    const fileInput = document.getElementById("videoFile");
    const fileButton = document.getElementById("fileButton");
    const fileName = document.getElementById("fileName");

    /* 파일 버튼 클릭 */
    fileButton.addEventListener("click", () => {
        fileInput.click();
    });

    /* 파일 선택 표시 */
    fileInput.addEventListener("change", () => {
        if(fileInput.files.length > 0){
            fileName.textContent = fileInput.files[0].name;
        }
    });

    /* 언어 변경 */
    function changeLanguage(lang){

        document.querySelectorAll("[data-i18n]").forEach(el=>{
            const key = el.getAttribute("data-i18n");
            el.textContent = translations[lang][key];
        });

        Array.from(languageSelect.options).forEach(option=>{
            option.textContent = translations[lang].languages[option.value];
        });

        if(fileInput.files.length === 0){
            fileName.textContent = translations[lang].noFile;
        }

        document.documentElement.lang = lang;
        localStorage.setItem("uiLang", lang);
    }

    uiSelect.addEventListener("change", function(){
        changeLanguage(this.value);
    });

    const saved = localStorage.getItem("uiLang") || "ko";
    uiSelect.value = saved;
    changeLanguage(saved);

    /* =========================
       업로드 함수 (버튼 작동 핵심)
    ========================= */

    async function uploadFile(actionType){

        if(fileInput.files.length === 0){
            alert(translations[document.documentElement.lang].noFile);
            return;
        }

        const formData = new FormData();
        formData.append("audio", fileInput.files[0]);
        formData.append("action", actionType);
        formData.append("subtitle_lang", languageSelect.value);
        formData.append("dubbing_lang", languageSelect.value);

        const response = await fetch("/process", {
            method: "POST",
            body: formData
        });

        if(!response.ok){
            alert("Upload failed");
            return;
        }

        const data = await response.json();
        console.log("서버 응답:", data);
    }

    document.getElementById("subtitleBtn")
            .addEventListener("click", ()=>uploadFile("subtitle"));

    document.getElementById("dubbingBtn")
            .addEventListener("click", ()=>uploadFile("dubbing"));

});
</script>

</body>
</html>
