<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUBBY - AI 자막 & 더빙</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
    font-family: 'Inter', -apple-system, sans-serif;
    background-color: #f8fafc;
    color: #1e293b;
}
.glass-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(226, 232, 240, 0.8);
}
.upload-area {
    border: 2px dashed #cbd5e1;
    transition: all 0.2s ease;
}
.upload-area:hover {
    border-color: #3b82f6;
    background-color: #eff6ff;
}
.btn-primary {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    transition: transform 0.1s active;
}
.btn-primary:active { transform: scale(0.98); }
.custom-select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2364748b'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1em;
}
.loading-bar {
    height: 20px;
    width: 0%;
    background-color: #3b82f6;
    border-radius: 10px;
    transition: width 0.2s ease;
}
</style>
</head>
<body class="min-h-screen py-6 px-4">
<div class="max-w-5xl mx-auto">

    <!-- Header -->
    <header class="flex items-center mb-8">
        <img src="/static/logo.png" alt="DUBBY Logo" class="w-12 h-12 mr-3">
        <div>
            <h1 class="text-2xl font-bold">DUBBY</h1>
            <p class="text-sm text-slate-500">자동 자막 생성 및 AI 더빙</p>
        </div>
    </header>

    <main class="grid grid-cols-1 md:grid-cols-12 gap-6">
        <!-- Left: Upload + Settings -->
        <div class="md:col-span-5 lg:col-span-4">
            <div class="glass-card p-6 rounded-2xl shadow-sm space-y-4">
                <label class="block text-sm font-semibold mb-2">미디어 업로드</label>
                <label class="upload-area flex flex-col items-center justify-center p-6 rounded-xl cursor-pointer">
                    <svg class="w-8 h-8 text-slate-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <span class="text-xs text-slate-500 text-center" id="file-name">클릭하여 영상/오디오 선택</span>
                    <input type="file" id="videoFile" accept="video/*,audio/*" class="hidden" onchange="updateFileName(this)">
                </label>

                <div>
                    <label class="block text-sm font-semibold mb-2">언어 선택 (자막 + 더빙)</label>
                    <select id="language" class="custom-select w-full p-3 bg-white border border-slate-200 rounded-xl text-sm">
                        <option value="ko">한국어</option>
                        <option value="en">영어</option>
                        <option value="ja">일본어</option>
                        <option value="zh-cn">중국어</option>
                    </select>
                </div>

                <button id="processBtn" class="w-full btn-primary text-white p-3 rounded-xl font-bold flex justify-center items-center">
                    자막 + 더빙 생성
                </button>

                <!-- Progress Bar -->
                <div class="mt-4">
                    <div class="w-full bg-slate-200 rounded-full h-5">
                        <div id="progressBar" class="loading-bar"></div>
                    </div>
                    <p class="text-right text-xs mt-1" id="progressText">0%</p>
                </div>
            </div>
        </div>

        <!-- Right: Video + Subtitle -->
        <div class="md:col-span-7 lg:col-span-8">
            <div class="glass-card min-h-[400px] p-4 rounded-2xl flex flex-col items-center justify-center text-slate-400">
                <video id="resultVideo" controls class="hidden w-full rounded-lg mb-2"></video>
                <a id="subtitleLink" href="#" target="_blank" class="hidden text-blue-600 underline">자막 다운로드</a>
            </div>
        </div>
    </main>
</div>

<script>
const resultVideo = document.getElementById("resultVideo");
const subtitleLink = document.getElementById("subtitleLink");
const progressBar = document.getElementById("progressBar");
const progressText = document.getElementById("progressText");

function updateFileName(input) {
    if(input.files[0]){
        document.getElementById("file-name").textContent = input.files[0].name;
    }
}

async function uploadFile(){
    const fileInput = document.getElementById("videoFile");
    const language = document.getElementById("language").value;

    if(!fileInput.files[0]){
        alert("파일을 선택하세요!");
        return;
    }

    const formData = new FormData();
    formData.append("audio", fileInput.files[0]);
    formData.append("action", "both");
    formData.append("language", language);

    progressBar.style.width = "0%";
    progressText.textContent = "0%";
    resultVideo.classList.add("hidden");
    subtitleLink.classList.add("hidden");

    // Fetch 요청
    const response = await fetch("/process", {
        method: "POST",
        body: formData
    });

    if(!response.ok){
        alert("서버 오류 발생");
        return;
    }

    // 진행률 애니메이션
    let progress = 0;
    const interval = setInterval(()=>{
        if(progress < 100){
            progress++;
            progressBar.style.width = progress+"%";
            progressText.textContent = progress+"%";
        } else {
            clearInterval(interval);
        }
    }, 30);

    const data = await response.json();
    clearInterval(interval);
    progressBar.style.width = "100%";
    progressText.textContent = "100%";

    if(data.video_path){
        resultVideo.src = data.video_path;
        resultVideo.classList.remove("hidden");
    }
    if(data.subtitle_path){
        subtitleLink.href = data.subtitle_path;
        subtitleLink.classList.remove("hidden");
    }
}

document.getElementById("processBtn").addEventListener("click", uploadFile);
</script>
</body>
</html>
