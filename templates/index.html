<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DUBBY - AI ìë§‰ & ë”ë¹™</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
    font-family: 'Inter', -apple-system, sans-serif;
    background-color: #f8fafc;
    color: #1e293b;
}

.glass-card {
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(226,232,240,0.8);
}

.loading-bar {
    height: 20px;
    width: 0%;
    background-color: #3b82f6;
    border-radius: 10px;
    transition: width 0.2s ease;
}

.country-btn {
    padding: 6px 10px;
    border-radius: 8px;
    border: 1px solid #cbd5e1;
    font-size: 13px;
    cursor: pointer;
}

.country-btn.active {
    background-color: #3b82f6;
    color: white;
}
</style>
</head>

<body class="min-h-screen py-6 px-4">

<!-- ===== ìƒë‹¨ í—¤ë” ===== -->
<div class="flex justify-between items-center max-w-6xl mx-auto mb-8">

    <!-- ì™¼ìª½ ë¡œê³  -->
    <div class="flex items-center">
        <img src="/static/logo.png" alt="DUBBY Logo" class="w-12 h-12 mr-3">
        <div>
            <h1 class="text-2xl font-bold">DUBBY</h1>
            <p class="text-sm text-slate-500">êµ­ê°€ ì „ìš© AI ìë§‰ & ë”ë¹™</p>
        </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ êµ­ê°€ ëª¨ë“œ -->
    <div class="flex gap-2">
        <button class="country-btn active" onclick="setCountry('ko', this)">ğŸ‡°ğŸ‡·</button>
        <button class="country-btn" onclick="setCountry('en', this)">ğŸ‡ºğŸ‡¸</button>
        <button class="country-btn" onclick="setCountry('ja', this)">ğŸ‡¯ğŸ‡µ</button>
        <button class="country-btn" onclick="setCountry('zh-cn', this)">ğŸ‡¨ğŸ‡³</button>
    </div>

</div>

<!-- ===== ë³¸ë¬¸ ===== -->
<div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-12 gap-6">

<!-- ì™¼ìª½ ì—…ë¡œë“œ ì˜ì—­ -->
<div class="md:col-span-4">
<div class="glass-card p-6 rounded-2xl shadow-sm space-y-4">

<input type="file" id="videoFile" accept="video/*,audio/*" class="w-full">

<button id="subtitleBtn" class="w-full bg-blue-600 text-white p-3 rounded-xl">
ìë§‰ ìƒì„±
</button>

<button id="dubbingBtn" class="w-full bg-slate-900 text-white p-3 rounded-xl">
ë”ë¹™ ìƒì„±
</button>

<!-- ì§„í–‰ë¥  -->
<div>
    <div class="w-full bg-slate-200 rounded-full h-5">
        <div id="progressBar" class="loading-bar"></div>
    </div>
    <p class="text-right text-xs mt-1" id="progressText">0%</p>
</div>

</div>
</div>

<!-- ì˜¤ë¥¸ìª½ ì˜ìƒ ì˜ì—­ -->
<div class="md:col-span-8">
<div class="glass-card min-h-[400px] p-4 rounded-2xl flex flex-col items-center justify-center">

<video id="resultVideo" controls class="hidden w-full rounded-lg mb-2">
    <track id="subtitleTrack"
           kind="subtitles"
           src=""
           srclang="ko"
           label="ìë§‰"
           default>
</video>

<a id="subtitleLink"
   href="#"
   target="_blank"
   class="hidden text-blue-600 underline">
   ìë§‰ ë‹¤ìš´ë¡œë“œ
</a>

</div>
</div>

</div>

<script>
let selectedLanguage = "ko";

function setCountry(lang, btn){
    selectedLanguage = lang;
    document.querySelectorAll(".country-btn")
            .forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}

async function uploadFile(actionType){

    const fileInput = document.getElementById("videoFile");
    if(!fileInput.files[0]){
        alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.");
        return;
    }

    const formData = new FormData();
    formData.append("audio", fileInput.files[0]);
    formData.append("action", actionType);
    formData.append("subtitle_lang", selectedLanguage);
    formData.append("dubbing_lang", selectedLanguage);

    const progressBar = document.getElementById("progressBar");
    const progressText = document.getElementById("progressText");
    const resultVideo = document.getElementById("resultVideo");
    const subtitleLink = document.getElementById("subtitleLink");
    const subtitleTrack = document.getElementById("subtitleTrack");

    progressBar.style.width = "0%";
    progressText.textContent = "0%";

    let progress = 0;
    const interval = setInterval(()=>{
        if(progress < 95){
            progress++;
            progressBar.style.width = progress + "%";
            progressText.textContent = progress + "%";
        }
    }, 100);

    const response = await fetch("/process", {
        method: "POST",
        body: formData
    });

    clearInterval(interval);

    if(!response.ok){
        alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
        return;
    }

    const data = await response.json();

    progressBar.style.width = "100%";
    progressText.textContent = "100%";

    if(data.video_path){
        resultVideo.src = data.video_path;
        resultVideo.classList.remove("hidden");
    }

    if(data.subtitle_path){
        subtitleLink.href = data.subtitle_path;
        subtitleLink.classList.remove("hidden");

        subtitleTrack.src = data.subtitle_path;
        subtitleTrack.srclang = selectedLanguage;
        subtitleTrack.mode = "showing";

        resultVideo.classList.remove("hidden");
    }
}

document.getElementById("subtitleBtn")
        .addEventListener("click", ()=>uploadFile("subtitle"));

document.getElementById("dubbingBtn")
        .addEventListener("click", ()=>uploadFile("dubbing"));
</script>

</body>
</html>
